<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boulder Happy Hours</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-orange-50 to-amber-50 min-h-screen">
    <div id="root"></div>
    
    <script type="module">
        const React = await import('https://esm.sh/react@18.2.0');
        const ReactDOM = await import('https://esm.sh/react-dom@18.2.0/client');
        
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        const SHEET_ID = '1fOO4xaEGOmRbL1IYHl0YbU2acWxoksjfaJBm9uf4rp4';
        const SHEET_CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=0`;
        
        const DAYS = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const result = [];
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const values = [];
                let current = '';
                let inQuotes = false;
                
                for (let char of line) {
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current.trim());
                
                if (values[0]) {
                    const deal = {
                        venue: values[0],
                        city: values[1] || '',
                        day: values[2] || '',
                        deal_type: values[3] || '',
                        time: values[4] || '',
                        deal_description: values[5] || '',
                        beer: (values[6] || '').toLowerCase().trim() === 'x',
                        wine: (values[7] || '').toLowerCase().trim() === 'x',
                        cocktail: (values[8] || '').toLowerCase().trim() === 'x',
                        margarita: (values[9] || '').toLowerCase().trim() === 'x'
                    };
                    
                    // Debug log for drinks with margarita tag
                    if (deal.margarita) {
                        console.log('Margarita deal found:', deal);
                    }
                    
                    result.push(deal);
                }
            }
            
            console.log('Total deals parsed:', result.length);
            console.log('All deals:', result);
            
            return result;
        }
        
        function App() {
            const [deals, setDeals] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            
            // Filters
            const [selectedDay, setSelectedDay] = useState('');
            const [dealType, setDealType] = useState('all');
            const [drinkFilter, setDrinkFilter] = useState('all');
            
            // Get current day
            useEffect(() => {
                const today = new Date().getDay();
                setSelectedDay(DAYS[today]);
            }, []);
            
            // Fetch data
            useEffect(() => {
                async function fetchDeals() {
                    try {
                        const response = await fetch(SHEET_CSV_URL);
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        const csvText = await response.text();
                        const parsedDeals = parseCSV(csvText);
                        
                        setDeals(parsedDeals);
                        setLoading(false);
                    } catch (err) {
                        console.error('Error fetching deals:', err);
                        setError('Failed to load deals. Please refresh the page.');
                        setLoading(false);
                    }
                }
                
                fetchDeals();
            }, []);
            
            // Filter deals
            const filteredDeals = deals.filter(deal => {
                // Handle "Daily" deals - they appear on every day
                const matchesDay = deal.day === selectedDay || deal.day.toLowerCase() === 'daily';
                
                if (!matchesDay) return false;
                if (dealType !== 'all' && deal.deal_type !== dealType) return false;
                
                if (dealType === 'Drink' && drinkFilter !== 'all') {
                    if (drinkFilter === 'beer' && !deal.beer) return false;
                    if (drinkFilter === 'wine' && !deal.wine) return false;
                    if (drinkFilter === 'cocktail' && !deal.cocktail) return false;
                    if (drinkFilter === 'margarita' && !deal.margarita) return false;
                }
                
                return true;
            });
            
            // Sort by time
            const sortedDeals = [...filteredDeals].sort((a, b) => {
                const getStartTime = (timeStr) => {
                    if (!timeStr) return 24;
                    const match = timeStr.match(/(\d+)/);
                    return match ? parseInt(match[1]) : 24;
                };
                
                return getStartTime(a.time) - getStartTime(b.time);
            });
            
            if (loading) {
                return React.createElement('div', { className: 'flex items-center justify-center min-h-screen' },
                    React.createElement('div', { className: 'text-xl text-gray-600' }, 'Loading happy hours...')
                );
            }
            
            if (error) {
                return React.createElement('div', { className: 'flex items-center justify-center min-h-screen' },
                    React.createElement('div', { className: 'text-xl text-red-600' }, error)
                );
            }
            
            return React.createElement('div', { className: 'container mx-auto px-4 py-8 max-w-6xl' },
                // Header
                React.createElement('div', { className: 'text-center mb-8' },
                    React.createElement('h1', { className: 'text-5xl font-bold text-amber-900 mb-2' }, 'üçª Boulder Happy Hours'),
                    React.createElement('p', { className: 'text-lg text-gray-600' }, 'Find the best deals in Boulder County')
                ),
                
                // Day Filter
                React.createElement('div', { className: 'mb-6' },
                    React.createElement('div', { className: 'flex flex-wrap gap-2 justify-center' },
                        ...DAYS.map(day =>
                            React.createElement('button', {
                                key: day,
                                onClick: () => setSelectedDay(day),
                                className: `px-4 py-2 rounded-lg font-medium transition-all ${
                                    selectedDay === day
                                        ? 'bg-amber-600 text-white shadow-lg scale-105'
                                        : 'bg-white text-gray-700 hover:bg-amber-100'
                                }`
                            }, day)
                        )
                    )
                ),
                
                // Deal Type Toggle
                React.createElement('div', { className: 'mb-6' },
                    React.createElement('div', { className: 'flex gap-2 justify-center' },
                        React.createElement('button', {
                            onClick: () => { setDealType('all'); setDrinkFilter('all'); },
                            className: `px-6 py-2 rounded-lg font-medium transition-all ${
                                dealType === 'all' ? 'bg-purple-600 text-white shadow-lg' : 'bg-white text-gray-700 hover:bg-purple-100'
                            }`
                        }, 'All'),
                        React.createElement('button', {
                            onClick: () => { setDealType('Food'); setDrinkFilter('all'); },
                            className: `px-6 py-2 rounded-lg font-medium transition-all ${
                                dealType === 'Food' ? 'bg-green-600 text-white shadow-lg' : 'bg-white text-gray-700 hover:bg-green-100'
                            }`
                        }, 'üçï Food'),
                        React.createElement('button', {
                            onClick: () => setDealType('Drink'),
                            className: `px-6 py-2 rounded-lg font-medium transition-all ${
                                dealType === 'Drink' ? 'bg-blue-600 text-white shadow-lg' : 'bg-white text-gray-700 hover:bg-blue-100'
                            }`
                        }, 'üç∫ Drink')
                    )
                ),
                
                // Drink Type Filter
                dealType === 'Drink' && React.createElement('div', { className: 'mb-6' },
                    React.createElement('h2', { className: 'text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide' }, 'Drink Type'),
                    React.createElement('div', { className: 'flex gap-2 justify-center' },
                        React.createElement('button', {
                            onClick: () => setDrinkFilter('all'),
                            className: `px-4 py-2 rounded-lg font-medium transition-all ${
                                drinkFilter === 'all' ? 'bg-blue-600 text-white shadow-lg' : 'bg-white text-gray-700 hover:bg-blue-100'
                            }`
                        }, 'All Drinks'),
                        React.createElement('button', {
                            onClick: () => setDrinkFilter('beer'),
                            className: `px-4 py-2 rounded-lg font-medium transition-all ${
                                drinkFilter === 'beer' ? 'bg-yellow-600 text-white shadow-lg' : 'bg-white text-gray-700 hover:bg-yellow-100'
                            }`
                        }, 'üç∫ Beer'),
                        React.createElement('button', {
                            onClick: () => setDrinkFilter('wine'),
                            className: `px-4 py-2 rounded-lg font-medium transition-all ${
                                drinkFilter === 'wine' ? 'bg-red-600 text-white shadow-lg' : 'bg-white text-gray-700 hover:bg-red-100'
                            }`
                        }, 'üç∑ Wine'),
                        React.createElement('button', {
                            onClick: () => setDrinkFilter('cocktail'),
                            className: `px-4 py-2 rounded-lg font-medium transition-all ${
                                drinkFilter === 'cocktail' ? 'bg-pink-600 text-white shadow-lg' : 'bg-white text-gray-700 hover:bg-pink-100'
                            }`
                        }, 'üç∏ Cocktails'),
                        React.createElement('button', {
                            onClick: () => setDrinkFilter('margarita'),
                            className: `px-4 py-2 rounded-lg font-medium transition-all ${
                                drinkFilter === 'margarita' ? 'bg-lime-600 text-white shadow-lg' : 'bg-white text-gray-700 hover:bg-lime-100'
                            }`
                        }, 'üçπ Margaritas')
                    )
                ),
                
                // Results Count
                React.createElement('div', { className: 'mb-4' },
                    React.createElement('p', { className: 'text-gray-600' },
                        React.createElement('span', { className: 'font-semibold text-amber-800' }, sortedDeals.length),
                        ` deal${sortedDeals.length !== 1 ? 's' : ''} found for ${selectedDay}`
                    )
                ),
                
                // Deals Grid
                sortedDeals.length === 0
                    ? React.createElement('div', { className: 'text-center py-12 bg-white rounded-lg shadow' },
                        React.createElement('p', { className: 'text-xl text-gray-500' }, 'No deals found for this selection'),
                        React.createElement('p', { className: 'text-gray-400 mt-2' }, 'Try selecting a different day or filter')
                    )
                    : React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6' },
                        ...sortedDeals.map((deal, index) =>
                            React.createElement('div', {
                                key: index,
                                className: 'bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow overflow-hidden'
                            },
                                // Card Header
                                React.createElement('div', {
                                    className: `p-4 ${
                                        deal.deal_type === 'Food'
                                            ? 'bg-gradient-to-r from-green-500 to-green-600'
                                            : 'bg-gradient-to-r from-blue-500 to-blue-600'
                                    }`
                                },
                                    React.createElement('h3', { className: 'text-xl font-bold text-white' }, deal.venue),
                                    React.createElement('p', { className: 'text-green-50 text-sm' }, `üìç ${deal.city}`)
                                ),
                                
                                // Card Body
                                React.createElement('div', { className: 'p-4' },
                                    React.createElement('div', { className: 'flex items-center gap-2 mb-3' },
                                        React.createElement('span', {
                                            className: `px-3 py-1 rounded-full text-sm font-medium ${
                                                deal.deal_type === 'Food'
                                                    ? 'bg-green-100 text-green-800'
                                                    : 'bg-blue-100 text-blue-800'
                                            }`
                                        }, deal.deal_type === 'Food' ? 'üçï Food' : 'üç∫ Drink'),
                                        React.createElement('span', { className: 'px-3 py-1 bg-amber-100 text-amber-800 rounded-full text-sm font-medium' },
                                            `‚è∞ ${deal.time}`
                                        )
                                    ),
                                    
                                    // Drink Tags
                                    deal.deal_type === 'Drink' && React.createElement('div', { className: 'flex gap-2 mb-3' },
                                        deal.beer && React.createElement('span', { className: 'px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-medium' }, 'üç∫ Beer'),
                                        deal.wine && React.createElement('span', { className: 'px-2 py-1 bg-red-100 text-red-800 rounded text-xs font-medium' }, 'üç∑ Wine'),
                                        deal.cocktail && React.createElement('span', { className: 'px-2 py-1 bg-pink-100 text-pink-800 rounded text-xs font-medium' }, 'üç∏ Cocktail'),
                                        deal.margarita && React.createElement('span', { className: 'px-2 py-1 bg-lime-100 text-lime-800 rounded text-xs font-medium' }, 'üçπ Margarita')
                                    ),
                                    
                                    React.createElement('p', { className: 'text-gray-700 text-base leading-relaxed' }, deal.deal_description)
                                )
                            )
                        )
                    )
            );
        }
        
        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>