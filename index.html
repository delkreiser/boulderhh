<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boulder Happy Hours</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-orange-50 to-amber-50 min-h-screen">
    <div id="root"></div>
    
    <script type="module">
        import React, { useState, useEffect } from 'https://cdn.skypack.dev/react@18.2.0';
        import ReactDOM from 'https://cdn.skypack.dev/react-dom@18.2.0/client';

        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/1fOO4xaEGOmRbL1IYHl0YbU2acWxoksjfaJBm9uf4rp4/export?format=csv';
        
        const DAYS = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        
        function App() {
            const [deals, setDeals] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            
            // Filters
            const [selectedDay, setSelectedDay] = useState('');
            const [dealType, setDealType] = useState('all'); // 'all', 'Food', 'Drink'
            const [drinkFilter, setDrinkFilter] = useState('all'); // 'all', 'beer', 'cocktail', 'margarita'
            
            // Get current day
            useEffect(() => {
                const today = new Date().getDay();
                setSelectedDay(DAYS[today]);
            }, []);
            
            // Fetch data from Google Sheets
            useEffect(() => {
                async function fetchDeals() {
                    try {
                        const response = await fetch(SHEET_CSV_URL);
                        const csvText = await response.text();
                        
                        // Parse CSV
                        const rows = csvText.split('\n').map(row => {
                            // Simple CSV parser (handles basic cases)
                            const values = [];
                            let current = '';
                            let inQuotes = false;
                            
                            for (let char of row) {
                                if (char === '"') {
                                    inQuotes = !inQuotes;
                                } else if (char === ',' && !inQuotes) {
                                    values.push(current.trim());
                                    current = '';
                                } else {
                                    current += char;
                                }
                            }
                            values.push(current.trim());
                            return values;
                        });
                        
                        // Skip header row and filter out empty rows
                        const dealsData = rows.slice(1)
                            .filter(row => row[0] && row[0].length > 0)
                            .map(row => ({
                                venue: row[0],
                                city: row[1],
                                day: row[2],
                                deal_type: row[3],
                                time: row[4],
                                deal_description: row[5],
                                beer: row[6]?.toLowerCase() === 'x',
                                cocktail: row[7]?.toLowerCase() === 'x',
                                margarita: row[8]?.toLowerCase() === 'x'
                            }));
                        
                        setDeals(dealsData);
                        setLoading(false);
                    } catch (err) {
                        setError('Failed to load deals. Please try again.');
                        setLoading(false);
                    }
                }
                
                fetchDeals();
            }, []);
            
            // Filter deals
            const filteredDeals = deals.filter(deal => {
                // Filter by day
                if (deal.day !== selectedDay) return false;
                
                // Filter by deal type
                if (dealType !== 'all' && deal.deal_type !== dealType) return false;
                
                // Filter by drink type (only applies when dealType is 'Drink')
                if (dealType === 'Drink' && drinkFilter !== 'all') {
                    if (drinkFilter === 'beer' && !deal.beer) return false;
                    if (drinkFilter === 'cocktail' && !deal.cocktail) return false;
                    if (drinkFilter === 'margarita' && !deal.margarita) return false;
                }
                
                return true;
            });
            
            // Sort by time (earliest first)
            const sortedDeals = [...filteredDeals].sort((a, b) => {
                // Extract first time (e.g., "3-6pm" -> "3")
                const getStartTime = (timeStr) => {
                    if (!timeStr) return 24;
                    const match = timeStr.match(/(\d+)/);
                    return match ? parseInt(match[1]) : 24;
                };
                
                return getStartTime(a.time) - getStartTime(b.time);
            });
            
            if (loading) {
                return (
                    <div className="flex items-center justify-center min-h-screen">
                        <div className="text-xl text-gray-600">Loading happy hours...</div>
                    </div>
                );
            }
            
            if (error) {
                return (
                    <div className="flex items-center justify-center min-h-screen">
                        <div className="text-xl text-red-600">{error}</div>
                    </div>
                );
            }
            
            return (
                <div className="container mx-auto px-4 py-8 max-w-6xl">
                    {/* Header */}
                    <div className="text-center mb-8">
                        <h1 className="text-5xl font-bold text-amber-900 mb-2">
                            üçª Boulder Happy Hours
                        </h1>
                        <p className="text-lg text-gray-600">
                            Find the best deals in Boulder County
                        </p>
                    </div>
                    
                    {/* Day Filter */}
                    <div className="mb-6">
                        <h2 className="text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">
                            Select Day
                        </h2>
                        <div className="flex flex-wrap gap-2">
                            {DAYS.map(day => (
                                <button
                                    key={day}
                                    onClick={() => setSelectedDay(day)}
                                    className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                        selectedDay === day
                                            ? 'bg-amber-600 text-white shadow-lg scale-105'
                                            : 'bg-white text-gray-700 hover:bg-amber-100'
                                    }`}
                                >
                                    {day}
                                </button>
                            ))}
                        </div>
                    </div>
                    
                    {/* Deal Type Toggle */}
                    <div className="mb-6">
                        <h2 className="text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">
                            Deal Type
                        </h2>
                        <div className="flex gap-2">
                            <button
                                onClick={() => {
                                    setDealType('all');
                                    setDrinkFilter('all');
                                }}
                                className={`px-6 py-2 rounded-lg font-medium transition-all ${
                                    dealType === 'all'
                                        ? 'bg-purple-600 text-white shadow-lg'
                                        : 'bg-white text-gray-700 hover:bg-purple-100'
                                }`}
                            >
                                All
                            </button>
                            <button
                                onClick={() => {
                                    setDealType('Food');
                                    setDrinkFilter('all');
                                }}
                                className={`px-6 py-2 rounded-lg font-medium transition-all ${
                                    dealType === 'Food'
                                        ? 'bg-green-600 text-white shadow-lg'
                                        : 'bg-white text-gray-700 hover:bg-green-100'
                                }`}
                            >
                                üçï Food
                            </button>
                            <button
                                onClick={() => setDealType('Drink')}
                                className={`px-6 py-2 rounded-lg font-medium transition-all ${
                                    dealType === 'Drink'
                                        ? 'bg-blue-600 text-white shadow-lg'
                                        : 'bg-white text-gray-700 hover:bg-blue-100'
                                }`}
                            >
                                üç∫ Drink
                            </button>
                        </div>
                    </div>
                    
                    {/* Drink Type Filter (only show when Drink is selected) */}
                    {dealType === 'Drink' && (
                        <div className="mb-6">
                            <h2 className="text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">
                                Drink Type
                            </h2>
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setDrinkFilter('all')}
                                    className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                        drinkFilter === 'all'
                                            ? 'bg-blue-600 text-white shadow-lg'
                                            : 'bg-white text-gray-700 hover:bg-blue-100'
                                    }`}
                                >
                                    All Drinks
                                </button>
                                <button
                                    onClick={() => setDrinkFilter('beer')}
                                    className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                        drinkFilter === 'beer'
                                            ? 'bg-yellow-600 text-white shadow-lg'
                                            : 'bg-white text-gray-700 hover:bg-yellow-100'
                                    }`}
                                >
                                    üç∫ Beer
                                </button>
                                <button
                                    onClick={() => setDrinkFilter('cocktail')}
                                    className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                        drinkFilter === 'cocktail'
                                            ? 'bg-pink-600 text-white shadow-lg'
                                            : 'bg-white text-gray-700 hover:bg-pink-100'
                                    }`}
                                >
                                    üç∏ Cocktails
                                </button>
                                <button
                                    onClick={() => setDrinkFilter('margarita')}
                                    className={`px-4 py-2 rounded-lg font-medium transition-all ${
                                        drinkFilter === 'margarita'
                                            ? 'bg-lime-600 text-white shadow-lg'
                                            : 'bg-white text-gray-700 hover:bg-lime-100'
                                    }`}
                                >
                                    üçπ Margaritas
                                </button>
                            </div>
                        </div>
                    )}
                    
                    {/* Results Count */}
                    <div className="mb-4">
                        <p className="text-gray-600">
                            <span className="font-semibold text-amber-800">{sortedDeals.length}</span> deal{sortedDeals.length !== 1 ? 's' : ''} found for {selectedDay}
                        </p>
                    </div>
                    
                    {/* Deals Grid */}
                    {sortedDeals.length === 0 ? (
                        <div className="text-center py-12 bg-white rounded-lg shadow">
                            <p className="text-xl text-gray-500">
                                No deals found for this selection
                            </p>
                            <p className="text-gray-400 mt-2">
                                Try selecting a different day or filter
                            </p>
                        </div>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {sortedDeals.map((deal, index) => (
                                <div
                                    key={index}
                                    className="bg-white rounded-lg shadow-lg hover:shadow-xl transition-shadow overflow-hidden"
                                >
                                    {/* Card Header */}
                                    <div className={`p-4 ${
                                        deal.deal_type === 'Food' 
                                            ? 'bg-gradient-to-r from-green-500 to-green-600' 
                                            : 'bg-gradient-to-r from-blue-500 to-blue-600'
                                    }`}>
                                        <h3 className="text-xl font-bold text-white">
                                            {deal.venue}
                                        </h3>
                                        <p className="text-green-50 text-sm">
                                            üìç {deal.city}
                                        </p>
                                    </div>
                                    
                                    {/* Card Body */}
                                    <div className="p-4">
                                        <div className="flex items-center gap-2 mb-3">
                                            <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                                                deal.deal_type === 'Food'
                                                    ? 'bg-green-100 text-green-800'
                                                    : 'bg-blue-100 text-blue-800'
                                            }`}>
                                                {deal.deal_type === 'Food' ? 'üçï Food' : 'üç∫ Drink'}
                                            </span>
                                            <span className="px-3 py-1 bg-amber-100 text-amber-800 rounded-full text-sm font-medium">
                                                ‚è∞ {deal.time}
                                            </span>
                                        </div>
                                        
                                        {/* Drink Tags */}
                                        {deal.deal_type === 'Drink' && (
                                            <div className="flex gap-2 mb-3">
                                                {deal.beer && (
                                                    <span className="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs font-medium">
                                                        üç∫ Beer
                                                    </span>
                                                )}
                                                {deal.cocktail && (
                                                    <span className="px-2 py-1 bg-pink-100 text-pink-800 rounded text-xs font-medium">
                                                        üç∏ Cocktail
                                                    </span>
                                                )}
                                                {deal.margarita && (
                                                    <span className="px-2 py-1 bg-lime-100 text-lime-800 rounded text-xs font-medium">
                                                        üçπ Margarita
                                                    </span>
                                                )}
                                            </div>
                                        )}
                                        
                                        <p className="text-gray-700 text-base leading-relaxed">
                                            {deal.deal_description}
                                        </p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                    
                    {/* Footer */}
                    <div className="mt-12 text-center text-gray-500 text-sm">
                        <p>Add your happy hour deals to the Google Sheet to see them here!</p>
                    </div>
                </div>
            );
        }
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
